/**
 * MASCOT & LOGO INTERACTIONS
 * Spec: perch on audio bar, speech bubble, wave animation, logo effects
 */

/* ==================== MASCOT POSITIONING ==================== */

#mascotGuide {
  position: fixed;
  width: 140px;
  height: 140px;
  z-index: 45; /* Above audio controls (40) */
  opacity: 1;
  pointer-events: auto;
  transition: opacity 0.3s ease;
  cursor: pointer;
}

#mascotGuide.is-speaking {
  opacity: 1 !important;
}

/* ==================== WAVE ANIMATION ==================== */

@keyframes wave {
  0%, 100% { transform: rotate(0deg); }
  25% { transform: rotate(-8deg); }
  50% { transform: rotate(8deg); }
  75% { transform: rotate(-8deg); }
}

#mascotGuide.is-waving {
  animation: wave 0.8s ease-out;
}

/* ==================== SPEECH BUBBLE ==================== */

.mascot-bubble {
  position: fixed;
  max-width: 280px;
  padding: 12px 16px;
  background: rgba(16, 16, 22, 0.96);
  color: #e5e7eb;
  font-size: 0.875rem;
  line-height: 1.5;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);
  z-index: 50;
  pointer-events: none;
  opacity: 0;
  transform: translate(-50%, 0) scale(0.9);
  transition: opacity 0.15s ease, transform 0.15s ease;
}

.mascot-bubble.is-open {
  opacity: 1;
  transform: translate(-50%, 0) scale(1);
  pointer-events: auto;
}

/* Speech bubble tail (triangle pointing down to mascot) */
.mascot-bubble::after {
  content: '';
  position: absolute;
  bottom: -8px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 8px solid transparent;
  border-right: 8px solid transparent;
  border-top: 8px solid rgba(16, 16, 22, 0.96);
}

/* ==================== HOME PAGE LOGO ==================== */

/* Make logo larger on home page */
.home-page #logoDoorway,
#home-door #logoDoorway {
  width: 180px;
  height: 180px;
}

.home-page #logoDoorway img,
#home-door #logoDoorway img {
  transform-origin: center;
  transition: transform 0.22s ease;
}

/* Hover effect - subtle scale + shimmer */
.home-page #logoDoorway:hover img,
#home-door #logoDoorway:hover img {
  transform: scale(1.02);
}

.home-page #logoDoorway:active img,
#home-door #logoDoorway:active img {
  transform: scale(0.98);
}

/* Shimmer effect (only if motion allowed) */
@media (prefers-reduced-motion: no-preference) {
  @keyframes shimmer {
    0% { filter: brightness(1); }
    50% { filter: brightness(1.15) drop-shadow(0 0 12px rgba(255, 255, 255, 0.3)); }
    100% { filter: brightness(1); }
  }

  .home-page #logoDoorway:hover img,
  #home-door #logoDoorway:hover img {
    animation: shimmer 0.8s ease-in-out;
  }
}

/* Inner page logo (smaller, standard) */
#site-header .header-logo {
  width: 48px;
  height: 48px;
  transition: transform 0.2s ease;
}

#site-header .header-logo:hover {
  transform: scale(1.05);
}

/* ==================== AUDIO BAR CONTEXT ==================== */

/* Audio controls wrapper */
#audio-controls {
  position: relative; /* For mascot anchoring */
}

/* Ensure audio controls have proper z-index stacking */
.audio-controls-fixed {
  z-index: 40;
}

/* ==================== REDUCED MOTION ==================== */

@media (prefers-reduced-motion: reduce) {
  #mascotGuide.is-waving {
    animation: none;
  }

  .home-page #logoDoorway:hover img,
  #home-door #logoDoorway:hover img {
    animation: none;
    filter: none;
  }

  .mascot-bubble {
    transition: opacity 0.1s ease, transform 0.1s ease;
  }

  #mascotGuide {
    transition: opacity 0.1s ease;
  }
}

/* ==================== RESPONSIVE ==================== */

@media (max-width: 768px) {
  /* Smaller mascot on mobile */
  #mascotGuide {
    width: 100px;
    height: 100px;
  }

  /* Adjust bubble size */
  .mascot-bubble {
    max-width: 240px;
    font-size: 0.8125rem;
    padding: 10px 14px;
  }

  /* Home logo slightly smaller on mobile */
  .home-page #logoDoorway,
  #home-door #logoDoorway {
    width: 140px;
    height: 140px;
  }
}

/* ==================== ACCESSIBILITY ==================== */

/* Focus styles for keyboard navigation */
#mascotGuide:focus {
  outline: 2px solid rgba(139, 162, 255, 0.6);
  outline-offset: 4px;
}

#mascotGuide:focus:not(:focus-visible) {
  outline: none;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .mascot-bubble {
    border: 2px solid currentColor;
    background: rgb(0, 0, 0);
  }
}
